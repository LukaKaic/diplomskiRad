<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">


    <title>
    </title>

    <style>

        .custom-radios div {
            display: flex;
            align-items: center;
        }
        .custom-radios input[type="radio"] {
            display: none;
        }
        .custom-radios input[type="radio"] + label {
            color: #333;
            font-family: Arial, sans-serif;
            font-size: 14px;
        }
        .custom-radios input[type="radio"] + label span {
            display: inline-block;
            width: 40px;
            height: 40px;
            margin: -1px 4px 0 0;
            vertical-align: middle;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #FFFFFF;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.33);
            background-repeat: no-repeat;
            background-position: center;
            text-align: center;
            line-height: 44px;
        }
        .custom-radios input[type="radio"] + label span img {
            opacity: 0;
            transition: all .3s ease;
        }
        .custom-radios input[type="radio"]#color-1 + label span {
            background-color: #2ecc71;
        }
        .custom-radios input[type="radio"]#color-2 + label span {
            background-color: #3498db;
        }
        .custom-radios input[type="radio"]#color-3 + label span {
            background-color: #f1c40f;
        }
        .custom-radios input[type="radio"]#color-4 + label span {
            background-color: #e74c3c;
        }
        .custom-radios input[type="radio"]:checked + label span img {
            opacity: 1;
        }

        .focus-in-expand {
            -webkit-animation: focus-in-expand 0.8s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
            animation: focus-in-expand 0.8s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
        }


        /* ----------------------------------------------
         * Generated by Animista on 2020-1-13 21:47:53
         * Licensed under FreeBSD License.
         * See http://animista.net/license for more info.
         * w: http://animista.net, t: @cssanimista
         * ---------------------------------------------- */

        /**
         * ----------------------------------------
         * animation focus-in-expand
         * ----------------------------------------
         */
        @-webkit-keyframes focus-in-expand {
            0% {
                letter-spacing: -0.5em;
                -webkit-filter: blur(12px);
                filter: blur(12px);
                opacity: 0;
            }
            100% {
                -webkit-filter: blur(0px);
                filter: blur(0px);
                opacity: 1;
            }
        }
        @keyframes focus-in-expand {
            0% {
                letter-spacing: -0.5em;
                -webkit-filter: blur(12px);
                filter: blur(12px);
                opacity: 0;
            }
            100% {
                -webkit-filter: blur(0px);
                filter: blur(0px);
                opacity: 1;
            }
        }

        .heartbeat {
            -webkit-animation: heartbeat 1.5s ease-in-out infinite both;
            animation: heartbeat 1.5s ease-in-out infinite both;
        }


        /* ----------------------------------------------
 * Generated by Animista on 2020-1-14 0:7:42
 * Licensed under FreeBSD License.
 * See http://animista.net/license for more info.
 * w: http://animista.net, t: @cssanimista
 * ---------------------------------------------- */

        /**
         * ----------------------------------------
         * animation heartbeat
         * ----------------------------------------
         */
        @-webkit-keyframes heartbeat {
            from {
                -webkit-transform: scale(1);
                transform: scale(1);
                -webkit-transform-origin: center center;
                transform-origin: center center;
                -webkit-animation-timing-function: ease-out;
                animation-timing-function: ease-out;
            }
            10% {
                -webkit-transform: scale(0.91);
                transform: scale(0.91);
                -webkit-animation-timing-function: ease-in;
                animation-timing-function: ease-in;
            }
            17% {
                -webkit-transform: scale(0.98);
                transform: scale(0.98);
                -webkit-animation-timing-function: ease-out;
                animation-timing-function: ease-out;
            }
            33% {
                -webkit-transform: scale(0.87);
                transform: scale(0.87);
                -webkit-animation-timing-function: ease-in;
                animation-timing-function: ease-in;
            }
            45% {
                -webkit-transform: scale(1);
                transform: scale(1);
                -webkit-animation-timing-function: ease-out;
                animation-timing-function: ease-out;
            }
        }
        @keyframes heartbeat {
            from {
                -webkit-transform: scale(1);
                transform: scale(1);
                -webkit-transform-origin: center center;
                transform-origin: center center;
                -webkit-animation-timing-function: ease-out;
                animation-timing-function: ease-out;
            }
            10% {
                -webkit-transform: scale(0.91);
                transform: scale(0.91);
                -webkit-animation-timing-function: ease-in;
                animation-timing-function: ease-in;
            }
            17% {
                -webkit-transform: scale(0.98);
                transform: scale(0.98);
                -webkit-animation-timing-function: ease-out;
                animation-timing-function: ease-out;
            }
            33% {
                -webkit-transform: scale(0.87);
                transform: scale(0.87);
                -webkit-animation-timing-function: ease-in;
                animation-timing-function: ease-in;
            }
            45% {
                -webkit-transform: scale(1);
                transform: scale(1);
                -webkit-animation-timing-function: ease-out;
                animation-timing-function: ease-out;
            }
        }

        .roll-in-left {
            -webkit-animation: roll-in-left 1s ease-out both;
            animation: roll-in-left 1s ease-out both;
        }

        /* ----------------------------------------------
 * Generated by Animista on 2020-1-14 0:14:16
 * Licensed under FreeBSD License.
 * See http://animista.net/license for more info.
 * w: http://animista.net, t: @cssanimista
 * ---------------------------------------------- */

        /**
         * ----------------------------------------
         * animation roll-in-left
         * ----------------------------------------
         */
        @-webkit-keyframes roll-in-left {
            0% {
                -webkit-transform: translateX(-800px) rotate(-540deg);
                transform: translateX(-800px) rotate(-540deg);
                opacity: 0;
            }
            100% {
                -webkit-transform: translateX(0) rotate(0deg);
                transform: translateX(0) rotate(0deg);
                opacity: 1;
            }
        }
        @keyframes roll-in-left {
            0% {
                -webkit-transform: translateX(-800px) rotate(-540deg);
                transform: translateX(-800px) rotate(-540deg);
                opacity: 0;
            }
            100% {
                -webkit-transform: translateX(0) rotate(0deg);
                transform: translateX(0) rotate(0deg);
                opacity: 1;
            }
        }


    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../public/css/custom.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
          rel="stylesheet">

    <script type="text/javascript">

        var i = 0
        var counter = 1
        var checkAnswerControl = 0

        $(document).ready(() => {

            jQuery('#questionBlock').hide()
            jQuery('#answersBlock').hide()
            $('#checkAnswerAlert').hide()
            $('#finalSection').hide()
            console.log("<%=user._id%>")
            counter = 1

            $.ajax({
                type: 'POST',
                data: JSON.stringify( { "userId":"<%=user._id%>"}),
                contentType: 'application/json',
                url: 'http://localhost:3000/resetScore',
                success: function(result) {
                    $('#score').html(result);
                }

            });
        })


        function startQuiz(id) {
            console.log(i)
            var userId = id;
            console.log(userId);
            // data.Id = userId;
            jQuery('#start').hide()
            jQuery('#questionBlock').show()
            jQuery('#answersBlock').show()
            $('#checkAnswerAlert').hide()

            $.ajax({
                type: 'POST',
                data: JSON.stringify({ "userId":userId, "counter" : i }),
                contentType: 'application/json',
                url: 'http://localhost:3000/quiz',
                success: function(result) {
                    console.log()
                    $('#question').html(result.result.questionText).addClass("focus-in-expand");
                    $('#answerOne').html(result.result.answers[0].answerText).addClass("focus-in-expand");
                    $('#answerTwo').html(result.result.answers[1].answerText).addClass("focus-in-expand");
                    $('#answerThree').html(result.result.answers[2].answerText).addClass("focus-in-expand");
                }
            });

        }

        function checkAnswer() {

            checkAnswerControl = 1
            $('#checkAnswerAlert').hide()
            $('#btnCheckAnswer').removeClass("heartbeat");
            $('#btnNextQuestion').addClass("heartbeat");

            answerId =
                $('input[name=answer]:checked',
                    '#answersBlock').val();

                $.ajax({
                    type: 'POST',
                    data: JSON.stringify({ "userId":"<%=user._id%>", "counter" : i }),
                    contentType: 'application/json',
                    url: 'http://localhost:3000/quiz',
                    success: function(result) {
                        let questionId = result.result._id;
                        console.log("answerId " + answerId);

                        let answerScore = result.result.answers[answerId-1].answerResult; //asnwerId uvijek ide od 1 do 3

                        $.ajax({
                            type: 'POST',
                            data: JSON.stringify({ "questionId": questionId, "answerId" : answerId }),
                            contentType: 'application/json',
                            url: 'http://localhost:3000/checkAnswer',
                            success: function(result) {
                                console.log(result)
                                $('#questionExplanation').html("Vaš odogovor vam donosi : " + result.bold() +" bodova!" + "\n Pitisnite > za iduće pitanje").show().addClass("focus-in-expand");
                                $('#nextQuestion').html("Ovdje ide pojasnjenje odgovora").show().addClass("focus-in-expand");
                            }
                        })
                        console.log("counter" + counter)
                        if(counter) {
                            console.log("usao" + counter)
                            $.ajax({
                                type: 'POST',
                                data: JSON.stringify( { "userId":"<%=user._id%>", "answerScore" : answerScore }),
                                contentType: 'application/json',
                                url: 'http://localhost:3000/updateScore',
                                success: function(result) {
                                    console.log("result of number" + result)
                                    $('#score').html(result).addClass("focus-in-expand");
                                    counter = 0;
                                }
                            });

                        }

                    }
                });




        }


        function nextQuestion() {

            $('#question').removeClass("focus-in-expand");
            $('#answerOne').removeClass("focus-in-expand");
            $('#answerTwo').removeClass("focus-in-expand");
            $('#answerThree').removeClass("focus-in-expand");
            $('#btnNextQuestion').removeClass("heartbeat");
            $('#btnCheckAnswer').addClass("heartbeat");

            answerId =
                $('input[name=answer]:checked',
                    '#answersBlock').val();

            $('#questionExplanation').hide()
            $('#nextQuestion').hide()

            if(checkAnswerControl) {

                checkAnswerControl = 0
                i++
                console.log(i);
                counter = 1

                $.ajax({
                    type: 'POST',
                    data: JSON.stringify({ "userId":"<%=user._id%>", "counter" : i }),
                    contentType: 'application/json',
                    url: 'http://localhost:3000/quiz',
                    success: function(result) {

                        console.log(result);

                        if(result.result !== undefined) {
                            console.log("result" + result)
                            $('#question').html(result.result.questionText).addClass("focus-in-expand");
                            $('#answerOne').html(result.result.answers[0].answerText).addClass("focus-in-expand");
                            $('#answerTwo').html(result.result.answers[1].answerText).addClass("focus-in-expand");
                            $('#answerThree').html(result.result.answers[2].answerText).addClass("focus-in-expand");
                        } else {
                            $('#questionBlock').hide()
                            $('#answersBlock').hide()
                            $('#finalSection').show()
                            $.ajax({
                                type: 'POST',
                                data: JSON.stringify( { "userId":"<%=user._id%>" }),
                                contentType: 'application/json',
                                url: 'http://localhost:3000/checkScore',
                                success: function(result) {
                                    console.log("result of number" + result)
                                    $('#finalScore').html(result).addClass("focus-in-expand");
                                }
                            });
                        }




//                        let answerScore = result.result.answers[answerId].answerResult;

                    }


                });

            } else {
                $('#checkAnswerAlert').html("Hej! Prvo projveri odgovor pa odi na sljedeci :)").show()
            }





        }


    </script>

    <style>
        .vl {
            border-left: 0.5px solid gray;
            height: 50px;
        }

    </style>


</head>

<body>

<% include header.ejs %>

<!--ako zelis da se makne prvi tekst upisi samo id="start"-->
<div class="container-fluid focus-in-expand" >
    <div class="row">
        <div class="col-md-6">
            <h5>Dobrodosli u edukacijsku igru vodenja globalnih projekata.</h5>
            <hr>
        </div>
        <div class="col-md-6">
            <h5><%=user.fullName%></h5>
            <hr>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <p>Vi ste dodijeljeni timu kao voda projekta i imate ulogu projektnog managera. Vasa kompanija ABC koja se nalazi u UK-u akvizirala je kompaniju BCD koja se nalazi u Americi. BCD kompanija sve svoje resurse za razvoj smjesta u Indiju te time ovaj projekt zahvaca Ameriku, UK i Indiju. Dodijeljen Vam je tim od osmero ljudi ukljucujuci Vas. Razvojni resursi smjesteni su Vam u Inidiji gdje imate tri resursa koja se bave razvojem I migracijom sustava. U UK-u nalazi se glavni ured u kojem se nalazi sponzor projekta i tehnicki prodavac dok u Americi imate tim prodaje koji se sastoji od dvoje ljudi. Ovaj projekt od strateske je vaznosti vase kompanije koja na ovaj nacin probija americko trziste.</p>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <button type="button" id="<%=user._id%>" onclick="startQuiz(this.id)" class="btn btn-success waves-effect waves-light btn-sm text-focus-in">Zapocni<i class=" fi-check"></i></button>
        </div>
    </div>

</div>

<div class="container" id="questionBlock">
    <div class="row">
        <div class="col-md-10">
            <span style="text-align: center" id="question">
            </span>
        </div>
        <div class="col-md-2 vl">
            <span style="text-align: center" id="score">
            </span>
        </div>
    </div>
</div>
        <!--<div class="row" style="padding-top: 10rem">-->
                <!--<div class="col-md-12"  id="answerOne">answer 1<hr></div>-->
                <!--<div class="col-md-12"id="answerTwo">answer 2<hr></div>-->
                <!--<div class="col-md-12" id="answerThree">answer 3<hr></div>-->
                <!--<button type="button" id="1" onclick="nextQuestion(this.id)" class="btn">Next<i class=" fi-check"></i></button>-->

            <!--</div>-->
        <!--</div>-->
        <!--<div class="col-md-4">.col-md-4</div>-->

<div class="container" id="answersBlock">
    <div class="custom-radios" style="padding-top: 5rem">
        <div>
            <input type="radio" id="color-1" name="answer" value="1" checked>
            <label for="color-1">
      <span >
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/242518/check-icn.svg" alt="Checked Icon" />
      </span>
            <label id="answerOne"></label>
            </label>
        </div>

        <hr>

        <div>
            <input type="radio" id="color-2" name="answer" value="2">
            <label for="color-2">
      <span>
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/242518/check-icn.svg" alt="Checked Icon" />
      </span>
                <label id="answerTwo"></label>
            </label>
        </div>

        <hr>

        <div>
            <input type="radio"  id="color-3" name="answer" value="3">
            <label for="color-3">
      <span>
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/242518/check-icn.svg" alt="Checked Icon" />
      </span>
                <label id="answerThree"></label>
            </label>
        </div>

        <hr>

    </div>

    <div class="container">
        <div class="row">
            <label id="questionExplanation" style="font-size: 1rem"></label>
        </div>
        <div class="row">
            <label id="nextQuestion" style="color: #1e7e34"></label>
        </div>

    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-10">
                <button type="button" id="btnCheckAnswer" onclick="checkAnswer()" style="border: 0.5px solid gray" class="btn heartbeat">Projveri odgovor</button>
            </div>

            <div class="col-md-2 vl">
                <label id="checkAnswerAlert"></label>
                <button type="button" id="btnNextQuestion" onclick="nextQuestion()" class="btn" style="border: 0.5px solid gray; justify-content: flex-end"><i class="material-icons">
                        navigate_next
                    </i></button>
            </div>
        </div>
    </div>

</div>

<div class="container" id="finalSection">
    <div class="row">
        <div class="col-md-12">
            <p>Cestitamo na uspjesno zavrsenom kvizu, Vas broj ostvarenih bodova je sljedeci: </p>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h1 style="text-align: center" id="finalScore"> </h1>
        </div>
    </div>
</div>



<!--<a href="/logout" id="logOutBtn" class="btn btn-warning btn-lg">Logout</a>-->

</body>



<script type = "text/javascript">


</script>
</html>
